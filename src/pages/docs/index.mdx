import { useState } from 'react';

export const endpoints = [
    {
        category: "Authentication",
        path: "/v1/auth/create-key",
        method: "POST",
        summary: "Create a new API key for an user",
        description:
            `Creates a new API key for the specified username.
            Query Parameter: username (string, required, max 16 characters).
            Usernames are unique.`,
        responseExample:
`{
  "username": "john_doe",
  "api_key": "abcdef1234567890abcdef1234567890",
  "role": "user"
}`,
    },
    {
        category: "Images",
        path: "/v1/img/search",
        method: "GET",
        summary: "Search and list images with filters and pagination",
        description:
            "Searches for images using optional filters: nsfw, character, tags, anime, category, page, size.",
        responseExample:
`{
    "page": 1,
    "size": 5,
    "total": 1,
    "items": [
        {
            "_id": "67c3dd97804bb4969297dd8f",
            "url": "https://cdn.nijii.xyz/images/waifu/5a35ea9b-750a-43dc-8071-f8dac2f19b41.jpg",
            "category": "waifu",
            "anime": null,
            "nsfw": false,
            "character": null,
            "tags": [
                "pink hair",
                "cute"
            ]
        }
    ]
}`,
    },
    {
        category: "Images",
        path: "/v1/img/waifu",
        method: "GET",
        summary: "Retrieve waifu images",
        description:
            "Retrieves images with the category 'waifu', with optional NSFW filtering and pagination.",
        responseExample:
`{
    "page": 1,
    "size": 5,
    "total": 1,
    "items": [
        {
            "_id": "67c3dd97804bb4969297dd8f",
            "url": "https://cdn.nijii.xyz/images/waifu/5a35ea9b-750a-43dc-8071-f8dac2f19b41.jpg",
            "category": "waifu",
            "anime": null,
            "nsfw": false,
            "character": null,
            "tags": [
                "pink hair",
                "cute"
            ]
        }
    ]
}`,
    },
    {
        category: "Images",
        path: "/v1/img/husbando",
        method: "GET",
        summary: "Retrieve husbando images",
        description:
            "Retrieves images with the category 'husbando', with optional NSFW filtering and pagination.",
        responseExample:
`{
    "page": 1,
    "size": 5,
    "total": 1,
    "items": [
        {
            "_id": "67c3d815804bb4969297dd8e",
            "url": "https://cdn.nijii.xyz/images/husbando/b363c484-3850-480a-bd4b-e9bf545c7007.gif",
            "category": "husbando",
            "anime": "Fire Force",
            "nsfw": false,
            "character": [
                "Shinra Kusakabe"
            ],
            "tags": [
                "shinra",
                "fire force"
            ]
        }
    ]
}`,
    },
    {
        category: "Images",
        path: "/v1/img/random",
        method: "GET",
        summary: "Retrieve a random image with optional filters",
        description:
            "Retrieves random images based on optional filters (nsfw, character, tags) in a paginated format.",
        responseExample:
`{
    "page": 1,
    "size": 5,
    "total": 2,
    "items": [
        {
            "_id": "67c3d815804bb4969297dd8e",
            "url": "https://cdn.nijii.xyz/images/husbando/b363c484-3850-480a-bd4b-e9bf545c7007.gif",
            "category": "husbando",
            "anime": "Fire Force",
            "nsfw": false,
            "character": [
                "Shinra Kusakabe"
            ],
            "tags": [
                "shinra",
                "fire force"
            ]
        },
        {
            "_id": "67c3dd97804bb4969297dd8f",
            "url": "https://cdn.nijii.xyz/images/waifu/5a35ea9b-750a-43dc-8071-f8dac2f19b41.jpg",
            "category": "waifu",
            "anime": null,
            "nsfw": false,
            "character": null,
            "tags": [
                "pink hair",
                "cute"
            ]
        }
    ]
}`,
    },
    {
        category: "Images",
        path: "/v1/img/",
        method: "POST",
        summary: "Post a new image",
        description:
            "Downloads an image from the provided URL, saves it locally, and stores its metadata in the database. Only users with at least the **team** role are authorized.",
        responseExample:
`{
  "detail": "Image added successfully.",
  "image": {
    "_id": "615d2b4e1d5c3a1f8c3e1d4f",
    "url": "https://cdn.nijii.xyz/images/waifu/unique_filename.jpg",
    "category": "waifu",
    "anime": "My Hero Academia",
    "nsfw": false,
    "character": "Ochaco Uraraka",
    "tags": [
      "cute",
      "anime"
    ]
  }
}`,
    },
    {
        category: "Images",
        path: "/v1/img/{image_id}",
        method: "PUT",
        summary: "Update an existing image",
        description:
            "Updates an existing image record. Only **admin** users are authorized to update images.",
        responseExample:
`{{
  "detail": "Image updated successfully.",
  "image": {
    "_id": "615d2b4e1d5c3a1f8c3e1d4f",
    "url": "https://cdn.nijii.xyz/images/waifu/new_unique_filename.jpg",
    "category": "waifu",
    "anime": "My Hero Academia",
    "nsfw": false,
    "character": "Ochaco Uraraka",
    "tags": [
      "cute",
      "anime"
    ]
  }
}`,
    },
    {
        category: "Images",
        path: "/v1/img/{image_id}",
        method: "DELETE",
        summary: "Delete an existing image",
        description:
            "Deletes an image record from the database and removes its corresponding file from disk. Only **admin** users are authorized to delete images.",
        responseExample: `{
  "detail": "Image deleted successfully."
}`,
    },
];

export function InteractiveSidebarDocs() {
    const [selectedEndpoint, setSelectedEndpoint] = useState(null);
    const [expandedCategories, setExpandedCategories] = useState({});
    const [searchTerm, setSearchTerm] = useState("");

    const categories = [...new Set(endpoints.map((ep) => ep.category))];

    const filteredEndpoints = endpoints.filter(
        (ep) =>
            ep.path.toLowerCase().includes(searchTerm.toLowerCase()) ||
            ep.summary.toLowerCase().includes(searchTerm.toLowerCase()) ||
            ep.method.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const endpointsByCategory = categories.reduce((acc, category) => {
        acc[category] = filteredEndpoints.filter((ep) => ep.category === category);
        return acc;
    }, {});

    const toggleCategory = (category) => {
        setExpandedCategories((prev) => ({
            ...prev,
            [category]: !prev[category],
        }));
    };

    return (
        <div className="flex flex-col md:flex-row">
            <aside className="md:w-1/4 border-r border-gray-200 p-4">
                <input
                    type="text"
                    placeholder="Search endpoints..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full p-2 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300"
                />
                {searchTerm.length > 0 ? (
                    <>
                        <h3 className="text-lg font-bold text-gray-800 mb-2">Search Results</h3>
                        <ul className="ml-4">
                            {filteredEndpoints.length > 0 ? (
                                filteredEndpoints.map((ep, idx) => (
                                    <li key={idx} className="mb-2">
                                        <button
                                            onClick={() => setSelectedEndpoint(ep)}
                                            className="text-left w-full p-2 rounded hover:bg-blue-100 focus:outline-none"
                                        >
                      <span className="text-xs font-mono font-bold text-white bg-blue-500 px-2 py-1 rounded mr-2">
                        {ep.method}
                      </span>
                                            <span className="text-sm text-gray-700">{ep.path}</span>
                                        </button>
                                    </li>
                                ))
                            ) : (
                                <div className="text-sm text-gray-500">No results found.</div>
                            )}
                        </ul>
                    </>
                ) : (
                    categories.map((category) => (
                        <div key={category} className="mb-4">
                            <div
                                className="flex items-center justify-between cursor-pointer text-lg font-bold text-gray-800 hover:text-blue-500"
                                onClick={() => toggleCategory(category)}
                            >
                                <span>{category}</span>
                                <span>{expandedCategories[category] ? "âˆ’" : "+"}</span>
                            </div>
                            {expandedCategories[category] && (
                                <ul className="mt-2 ml-4">
                                    {endpointsByCategory[category]?.map((ep, idx) => (
                                        <li key={idx} className="mb-2">
                                            <button
                                                onClick={() => setSelectedEndpoint(ep)}
                                                className="text-left w-full p-2 rounded hover:bg-blue-100 focus:outline-none"
                                            >
                        <span className="text-xs font-mono font-bold text-white bg-blue-500 px-2 py-1 rounded mr-2">
                          {ep.method}
                        </span>
                                                <span className="text-sm text-gray-700">{ep.path}</span>
                                            </button>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>
                    ))
                )}
            </aside>

            <main className="flex-1 p-6">
                {selectedEndpoint ? (
                    <div className="bg-white p-6 rounded-lg shadow-lg border border-gray-100">
                        <button
                            onClick={() => setSelectedEndpoint(null)}
                            className="mb-4 text-blue-500 hover:underline"
                        >
                            &larr; Back to list
                        </button>
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">
                            {selectedEndpoint.path}
                        </h2>
                        <div className="flex items-center mb-4">
              <span className="text-xs font-mono font-bold text-white bg-blue-500 px-3 py-1 rounded-full mr-4">
                {selectedEndpoint.method}
              </span>
                            <span className="text-lg text-gray-700">
                {selectedEndpoint.summary}
              </span>
                        </div>
                        <div className="text-gray-700 mb-4">
                            <strong>Description:</strong>
                            <div className="mt-1 whitespace-pre-line">{selectedEndpoint.description}</div>
                        </div>
                        {selectedEndpoint.responseExample && (
                            <div className="bg-gray-50 p-4 rounded border border-gray-200">
                                <strong>Response Example:</strong>
                                <pre className="mt-2 text-sm text-gray-800 overflow-x-auto whitespace-pre-wrap">
                  {selectedEndpoint.responseExample}
                </pre>
                            </div>
                        )}
                    </div>
                ) : (
                    <div className="text-center text-gray-500 py-20">
                        <p className="text-lg">Select an endpoint from the sidebar to view details.</p>
                    </div>
                )}
            </main>
        </div>
    );
}

<div className="max-w-5xl mx-auto px-4">
    <header className="text-center my-10">
        <h1 className="text-5xl font-extrabold text-gray-900 mb-4">
            Niji API Documentation
        </h1>
        <div className="text-xl text-gray-700">
            Welcome to the official Niji API documentation for anime-related endpoints.
            Use the sidebar to filter by category or search directly, and view endpoint details including response examples.
        </div>
    </header>

    <section>
        <InteractiveSidebarDocs />
    </section>

    <section className="mt-16">
        <h2 className="text-3xl font-bold text-gray-800 border-b-2 pb-2 mb-6">
            API Details
        </h2>
        <div className="bg-gray-50 p-6 rounded-lg shadow-lg">
            <h3 className="text-2xl font-semibold text-gray-800 mb-4">General Information</h3>
            <ul className="list-disc list-inside text-gray-700 mb-6">
                <li>
                    <span className="font-semibold">Title:</span> Niji API | Anime related API
                </li>
                <li>
                    <span className="font-semibold">Description:</span> This API manages anime/manga images. It supports uploading images via a source URL, saving them locally, and provides endpoints for anime related images.
                </li>
                <li>
                    <span className="font-semibold">Version:</span> 1.0.2
                </li>
                <li>
                    <span className="font-semibold">Categories:</span> husbando, waifu, random
                </li>
            </ul>
            <h3 className="text-2xl font-semibold text-gray-800 mb-4">Server</h3>
            <div className="text-gray-700">
                <span className="font-semibold">URL: </span> <a href="https://api.nijii.xyz" className="text-blue-500 hover:underline">https://api.nijii.xyz</a>
            </div>
        </div>
        <div className="mt-10 mb-10 p-6 bg-white rounded-lg shadow border">
            <h3 className="text-2xl font-semibold text-gray-800 mb-10">Endpoints Overview</h3>
            <div className="text-gray-700">
                Use the sidebar above to filter and select endpoints. Each endpoint displays its method, path, summary, description, and an example of its response.
            </div>
        </div>
    </section>
</div>